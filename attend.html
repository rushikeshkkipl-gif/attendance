<!DOCTYPE html>
<html>
<head>
  <title>Mark Attendance</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <h1>Attendance</h1>

    <form id="form">
      <input type="text" id="name" placeholder="Your name" required>
      <button type="submit">Submit</button>
    </form>

    <p id="msg"></p>
  </div>

<script>
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");

  if (!token) {
    document.body.innerHTML = "<h2>Attendance closed</h2>";
    throw new Error("No token");
  }

  document.getElementById("form").onsubmit = function(e) {
    e.preventDefault();

    const record = {
      name: document.getElementById("name").value,
      date: new Date().toLocaleDateString(),
      time: new Date().toLocaleTimeString()
    };

    fetch("https://script.google.com/macros/s/AKfycbz3j-kdQDguII4_UDyTxCYyzxySZF-ETkqzENKefrirkrRMJQHP8lslJ0MoimTOigQy/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(record)
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        document.getElementById("msg").innerText =
          "✅ Attendance marked";
      } else {
        document.getElementById("msg").innerText =
          "❌ Error saving attendance";
      }
    })
    .catch(() => {
      document.getElementById("msg").innerText =
        "❌ Network error";
    });
  };
</script>

</body>
</html>
